<div class="modal-overlay" (click)="onBackdropClick($event)">
    <div class="modal-content success-modal">
        <button class="modal-close" (click)="closeModal()">√ó</button>
        <div class="modal-header">
            <div class="header-content">
                <!-- <div class="success-icon">‚úì</div> -->
                <div class="header-text">
                    <h3>üéâ Thank You! Your booking has been confirmed.</h3>
                    <p class="subtitle">Booking #{{ bookingCode }}</p>
                </div>
            </div>
        </div>

        <div class="modal-body">
            <!-- Thank You Message (Compact) -->
            <div class="thank-you-message d-none" *ngIf="thankYouMessage">
                <div class="message-icon">üíå</div>
                <p class="message-text">{{ thankYouMessage }}</p>
            </div>

            <!-- Split Layout: QR Left + Details Right -->
            <div class="split-layout">
                <!-- Left Column - QR Code -->
                <div class="qr-column" *ngIf="qrCodeBase64">
                    <div class="qr-code-container">
                        <img [src]="'data:image/png;base64,' + qrCodeBase64" 
                             alt="Booking QR Code" 
                             class="qr-code-image"
                             (load)="onImageLoad()" 
                             (error)="onImageError()">
                        <div class="qr-loading" *ngIf="!imageLoaded && !imageError">
                            Loading...
                        </div>
                        <div class="qr-error" *ngIf="imageError">
                            ‚ùå Failed to load
                        </div>
                    </div>
                    <p class="qr-instruction">Present at venue entry</p>
                    <div class="qr-actions">
                        <button class="btn-download" (click)="downloadQRCode()" [disabled]="imageError || !imageLoaded">
                            ‚¨á Download
                        </button>
                        <button class="btn-share d-none" (click)="shareQRCode()" [disabled]="imageError || !imageLoaded">
                            üì§ Share
                        </button>
                    </div>
                </div>

                <!-- Right Column - Event Details -->
                <div class="details-column" *ngIf="bookingDetails">
                    <div class="event-details-card">
                        <h4 class="details-title">Event Details</h4>
                        
                        <div class="detail-row highlight-row d-none">
                            <span class="detail-label">Booking Code:</span>
                            <span class="detail-value booking-code">{{ bookingDetails.booking_code }}</span>
                        </div>
                        
                        <div class="detail-row">
                            <span class="detail-label">Event:</span>
                            <span class="detail-value">{{ bookingDetails.event_name }}</span>
                        </div>
                        
                        <div class="detail-row">
                            <span class="detail-label">Date:</span>
                            <span class="detail-value">{{ formatDate(bookingDetails.event_date) }}</span>
                        </div>
                        
                        <div class="detail-row">
                            <span class="detail-label">Time:</span>
                            <span class="detail-value">{{ bookingDetails.start_time }} - {{ bookingDetails.end_time }}</span>
                        </div>
                        
                        <div class="detail-row">
                            <span class="detail-label">Venue:</span>
                            <span class="detail-value">{{ bookingDetails.location }}</span>
                        </div>
                        
                        <div class="detail-row status-row d-none">
                            <span class="detail-label">Status:</span>
                            <span class="status-badge confirmed">{{ bookingDetails.status | titlecase }}</span>
                        </div>
                        
                        <div class="detail-row total-row d-none">
                            <span class="detail-label">Total Amount:</span>
                            <span class="total-amount-value">‚Çπ{{ bookingDetails.final_amount }}</span>
                        </div>
                    </div>

                    <!-- Seat Details (Compact) -->
                    <!-- Seat Details (Compact) -->
                    <div class="seat-summary" *ngIf="bookingDetails.bookingSeats?.length">
                        <div class="seat-summary-header">
                            <span>Seats</span>
                            <span>Qty</span>
                            <span>Price</span>
                        </div>
                        <div class="seat-summary-item" *ngFor="let seat of bookingDetails.bookingSeats">
                            <span class="seat-name">{{ seat.seat_name }}</span>
                            <span class="seat-qty">{{ seat.quantity }}</span>
                            <span class="seat-price">‚Çπ{{ seat.subtotal }}</span>
                        </div>
                        
                        <!-- Payment Breakdown Section - Added below seat summary -->
                        <div class="payment-breakdown">
                            <div class="breakdown-row">
                                <span class="breakdown-label">Subtotal:</span>
                                <span class="breakdown-value">‚Çπ{{ calculateSubtotal(bookingDetails.bookingSeats) }}</span>
                            </div>
                            <div class="breakdown-row">
                                <span class="breakdown-label">Convenience Fee:</span>
                                <span class="breakdown-value">‚Çπ{{ bookingDetails.convenience_fee || 0 }}</span>
                            </div>
                            <div class="breakdown-row">
                                <span class="breakdown-label">GST:</span>
                                <span class="breakdown-value">‚Çπ{{ bookingDetails.gst_amount || 0 }}</span>
                            </div>
                            <!-- NEW: Coupon Applied Row - Only shown if coupon was applied -->
                            <div class="breakdown-row coupon-row" *ngIf="bookingDetails?.discount_amount && bookingDetails?.coupon_code_applied">
                                <span class="breakdown-label coupon-label">
                                    Coupon Applied (<span class="coupon-code">{{ bookingDetails.coupon_code_applied }}</span>):
                                </span>
                                <span class="breakdown-value coupon-discount">- ‚Çπ{{ bookingDetails.discount_amount }}</span>
                            </div>
                            <div class="breakdown-row total-row">
                                <span class="breakdown-label">Total Final Value:</span>
                                <span class="breakdown-value final-value">‚Çπ{{ bookingDetails.final_amount || bookingDetails.total_amount }}</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Info Section (Compact) -->
            <div class="info-section">
                <!-- Email Notification -->
                <div class="email-notification" *ngIf="bookingDetails?.email">
                    <div class="email-icon">üìß</div>
                    <div class="email-text">
                        <p><strong>Email sent to:</strong> {{ bookingDetails.email }}</p>
                        <p class="email-note">Check spam folder</p>
                    </div>
                </div>

                <!-- Important Notes -->
                <div class="important-notes">
                    <ul>
                        <li>Arrive 30 mins early</li>
                        <li>Show QR at entry</li>
                        <li>No physical tickets</li>
                    </ul>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="modal-actions">
                <button class="btn-secondary" (click)="viewBookingDetails()">
                    üìã Details
                </button>
                <button class="btn-primary" (click)="goToEvents()">
                    ‚Üê Events
                </button>
            </div>
        </div>

        <div class="modal-footer">
            <p>support@tickethouse.in | Thank you for choosing <strong>TicketHouse</strong>!</p>
        </div>
    </div>
</div>