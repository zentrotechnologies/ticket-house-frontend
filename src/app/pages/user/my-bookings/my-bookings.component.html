<div class="my-bookings-page">
  <!-- Header -->
  <header class="bookings-header">
    <div class="container">
      <div class="header-row">
        <div class="header-col">
          <div class="left-section-content">
            <!-- <div class="logo-wrapper">
              <img class="logo" src="/assets/ticket-house-logo.jpeg" alt="ticket-house-logo" (click)="onBackToEvents()"
                style="cursor: pointer;" />
            </div> -->

            <!-- Page Title with Stats -->
            <div class="page-title">
              <h1>My Bookings</h1>
              <div class="booking-stats" *ngIf="bookings.length > 0">
                <span class="stat-item">
                  <span class="stat-label">Total Bookings:</span>
                  <span class="stat-value">{{ totalCount }}</span>
                </span>
                <span class="stat-item d-none">
                  <span class="stat-label">Tickets:</span>
                  <span class="stat-value">{{ getTotalTickets() }}</span>
                </span>
                <span class="stat-item d-none">
                  <span class="stat-label">Scanned:</span>
                  <span class="stat-value">{{ getTotalScanned() }}</span>
                </span>
                <span class="stat-item d-none">
                  <span class="stat-label">Remaining:</span>
                  <span class="stat-value">{{ getTotalRemaining() }}</span>
                </span>
              </div>
            </div>
          </div>
        </div>

        <div class="header-col actions-col">
          <div class="user-actions">
            <button class="back-btn" (click)="onBackToEvents()">‚Üê Back to Events</button>
          </div>
        </div>
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <main class="bookings-main">
    <div class="container">
      <!-- Search Bar -->
      <!-- <div class="search-section" *ngIf="bookings.length > 0 || filterText">
        <div class="search-container">
          <input type="text" class="search-input" placeholder="Search by event name or booking code..."
            [(ngModel)]="filterText" (keyup.enter)="onSearch()">
          <button class="search-btn" (click)="onSearch()">Search</button>
          <button class="clear-btn" *ngIf="filterText" (click)="clearSearch()">Clear</button>
        </div>
      </div> -->

      <!-- Loading State -->
      <div *ngIf="isLoading" class="loading-container">
        <div class="loading-spinner">Loading your bookings...</div>
      </div>

      <!-- No Bookings State -->
      <div *ngIf="!isLoading && bookings.length === 0" class="no-bookings">
        <div class="empty-state">
          <div class="empty-icon">üìã</div>
          <h2>No Bookings Found</h2>
          <p *ngIf="filterText">No bookings match your search criteria.</p>
          <p *ngIf="!filterText">You haven't made any bookings yet.</p>
          <button class="browse-events-btn" (click)="onBackToEvents()">Browse Events</button>
        </div>
      </div>

      <!-- Bookings List -->
      <div *ngIf="!isLoading && bookings.length > 0" class="bookings-list">
        <div class="list-header">
          <h2 class="section-title">Your Booking History</h2>
          <div class="page-size-selector">
            <label>Show:</label>
            <select [(ngModel)]="pageSize" (change)="onPageSizeChange()">
              <option *ngFor="let size of pageSizeOptions" [value]="size">{{ size }}</option>
            </select>
          </div>
        </div>

        <div class="bookings-grid">
          <div class="booking-card" *ngFor="let booking of bookings">
            <div class="booking-header">
              <div class="booking-id">
                <span class="label">Booking Code</span>
                <span class="value">{{ booking.booking_code }}</span>
              </div>
              <div class="booking-date ms-4 d-none">
                <i class="calendar-icon">üìÖ</i> {{ formatDate(booking.created_on) }}
              </div>
              <!-- ADD QR CODE SECTION HERE - Small QR code next to booking header -->
              <div class="booking-qr" *ngIf="booking.qr_code">
                <div class="qr-code-container" (click)="showQRCodeModal(booking)" title="Click to enlarge QR code">
                  <img [src]="'data:image/png;base64,' + booking.qr_code" alt="QR Code" class="qr-code-small" />
                </div>
              </div>
            </div>

            <div class="booking-body">
              <div class="event-info">
                <h3 class="event-name">{{ booking.event_name }}</h3>
                <p class="event-location">
                  <i class="bi bi-geo-alt-fill location-icon"></i> {{ booking.location }}
                </p>
                <p class="event-date-time">
                  <i class="bi bi-clock-fill time-icon"></i> {{ formatDate(booking.event_date) }} | {{ formatTime(booking.start_time) }}
                  - {{ formatTime(booking.end_time) }}
                </p>
              </div>

              <div class="booking-details">
                <div class="detail-item">
                  <span class="label">Tickets:</span>
                  <span class="value">
                    {{ getBookingTotalTickets(booking) }}
                  </span>
                </div>
                <div class="detail-item d-none">
                  <span class="label">Scanned:</span>
                  <span class="value">
                    {{ getBookingScannedTickets(booking) }}
                    / {{ getBookingTotalTickets(booking) }}
                  </span>
                </div>
                <div class="detail-item">
                  <span class="label">Amount:</span>
                  <span class="value">‚Çπ{{ booking.final_amount }}</span>
                </div>
                <div class="detail-item">
                  <span class="label">Payment Method:</span>
                  <span class="value payment-method-badge" [ngClass]="getPaymentMethodClass(booking.payment_method)">
                    {{ booking.payment_method ? (booking.payment_method | titlecase) : 'Not Paid' }}
                  </span>
                </div>
                <div class="detail-item">
                  <span class="label">Booking Status:</span>
                  <span class="value status-badge" [ngClass]="getStatusClass(booking.booking_status)">
                    {{ booking.booking_status }}
                  </span>
                </div>
                <div class="detail-item d-none">
                  <span class="label">Payment ID:</span>
                  <span class="value payment-id" [class.na-text]="!booking.razorpay_payment_id">
                    {{ booking.razorpay_payment_id || 'NA' }}
                  </span>
                </div>
              </div>

              <!-- Seat Details -->
              <div class="seat-details" *ngIf="booking.seats && booking.seats.length > 0">
                <h4>Seat Details</h4>
                <div class="seat-grid">
                  <div class="seat-item" *ngFor="let seat of booking.seats">
                    <div class="seat-info">
                      <span class="seat-name">{{ seat.seat_name }}</span>
                      <span class="seat-quantity">√ó {{ seat.quantity }}</span>
                    </div>
                    <div class="seat-scan-info">
                      <span class="scan-progress d-none">
                        Scanned: {{ seat.scanned_quantity }} / {{ seat.quantity }}
                      </span>
                      <span class="seat-price">‚Çπ{{ seat.subtotal }}</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- <div class="booking-footer">
              <button class="view-details-btn" (click)="viewBookingDetails(booking.booking_id)">
                View Details
              </button>
              <span class="payment-method" *ngIf="booking.payment_method">
                Paid via {{ booking.payment_method }}
              </span>
            </div> -->
          </div>
        </div>

        <!-- Pagination -->
        <div class="pagination-section" *ngIf="totalPages > 1">
          <div class="pagination-info">
            Showing page {{ currentPage }} of {{ totalPages }} ({{ totalCount }} total bookings)
          </div>
          <div class="pagination-controls">
            <button class="pagination-btn" [disabled]="!hasPrevious" (click)="onPageChange(currentPage - 1)">
              ‚Üê Previous
            </button>

            <div class="page-numbers">
              <button *ngFor="let page of [].constructor(totalPages); let i = index" class="page-number"
                [class.active]="currentPage === i + 1" (click)="onPageChange(i + 1)">
                {{ i + 1 }}
              </button>
            </div>

            <button class="pagination-btn" [disabled]="!hasNext" (click)="onPageChange(currentPage + 1)">
              Next ‚Üí
            </button>
          </div>
        </div>
      </div>
    </div>
  </main>

  <!-- Footer -->
  <footer class="bookings-footer">
    <div class="container">
      <p>Need help with your bookings? <a href="#">Contact Support</a></p>
      <p class="copyright">¬© 2025 Ticket House ‚Äì All rights reserved.</p>
    </div>
  </footer>

  <!-- QR Code Modal -->
  <div *ngIf="showQRModal" class="qr-modal-overlay" (click)="closeQRModal()">
    <div class="qr-modal-content" (click)="$event.stopPropagation()">
      <button class="qr-modal-close" (click)="closeQRModal()">√ó</button>
      <h3>Your Ticket QR Code</h3>
      <div class="qr-modal-image-container">
        <img [src]="'data:image/png;base64,' + selectedQRCode" alt="Booking QR Code" class="qr-modal-image" />
      </div>
      <p class="qr-modal-booking-code">
        <strong>{{ selectedBookingCode }}</strong> - {{ selectedEventName }}
      </p>
      <button class="qr-modal-download-btn" (click)="downloadQRCode()">
        Download QR Code
      </button>
    </div>
  </div>
</div>