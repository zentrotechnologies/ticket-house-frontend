<div class="audience-page audience-body">
    <!-- Events Header with Column Structure -->
    <!-- <header class="audience-header">
        <div class="container">
            <div class="header-row">
                <div class="header-col left-section-col">
                    <div class="left-section-content">
                        <div class="logo-wrapper">
                            <img class="logo" src="/assets/ticket-house-logo.jpeg" alt="ticket-house-logo" />
                        </div>
                        <div class="search-wrapper">
                            <div class="search">
                                <input placeholder="Search for Events, Artists, Location..." aria-label="search" />
                            </div>
                        </div>
                    </div>
                </div>
                <div class="header-col actions-col">
                    <div class="user-actions">
                        <div class="location muted">Pune ‚ñº</div>
                        <div class="pill" (click)="onSignIn()">Sign In</div>
                    </div>
                </div>
            </div>
        </div>
    </header> -->

    <!-- booking-page.component.html -->
    <!-- Loading State -->
    <div *ngIf="isLoading" class="loading-container">
        <div class="loading-spinner">Loading event details...</div>
    </div>

    <!-- Main Content -->
    <div *ngIf="!isLoading && eventDetails" class="booking-page">
        <main class="booking-container">
            <div class="booking-layout">
                <!-- LEFT: Hero + Content -->
                <div class="booking-main-content">
                    <!-- Hero Image -->
                    <div class="event-hero" role="region" aria-label="event hero">
                        <div class="hero-img" id="mainPosterWrap">
                            <img id="mainPoster"
                                [src]="eventDetails.banner_image || 'https://images.unsplash.com/photo-1511671782779-c97d3d27a1d4?auto=format&fit=crop&w=1400&q=60'"
                                [alt]="eventDetails.event_name" (click)="openImageModal(eventDetails.banner_image)">
                        </div>
                    </div>

                    <!-- Event Details -->
                    <div class="event-details-section">
                        <!-- Title -->
                        <div class="event-title">{{ eventDetails.event_name }}</div>

                        <div class="hero-details">
                            <!-- Tags/Categories - DYNAMIC NOW -->
                            <div class="tags">
                                <span *ngIf="getEventCategoryName()" class="tag">{{ getEventCategoryName() }}</span>
                                <!-- You can add more dynamic tags here if you have additional categories -->
                                <span class="tag">{{ eventDetails.language || 'English' }}</span>
                                <span *ngIf="eventDetails.is_featured" class="tag featured">Featured</span>
                            </div>

                            <div class="spacer"></div>

                            <!-- Interest Section -->
                            <div class="interested-row">
                                <div class="likes">üëç 514 are interested</div>
                                <button class="interested">I'm Interested</button>
                            </div>
                        </div>

                        <!-- About Section -->
                        <div class="about">
                            <div class="section-title">About The Event</div>
                            <p>{{ eventDetails.event_description }}</p>
                            <p class="muted">
                                Duration: {{ formatDuration(eventDetails.total_duration_minutes) }} ‚Ä¢
                                Language: {{ eventDetails.language || 'English' }} ‚Ä¢
                                Age: {{ eventDetails.age_limit ? eventDetails.age_limit + '+' : 'All age groups' }}
                            </p>

                            <!-- Terms & Conditions Row - Add this new section -->
                            <div class="terms-row" (click)="openTermsModal()">
                                <span class="terms-label">Terms & Conditions</span>
                                <!-- <span class="terms-icon">üìã</span> -->
                            </div>
                        </div>

                        <!-- Similar Shows Section -->
                        <div class="similar-shows" *ngIf="similarEvents.length > 0">
                            <div class="section-title">More Shows You Might Like</div>

                            <div *ngIf="isSimilarLoading" class="loading-mini">Loading similar events...</div>

                            <div *ngIf="!isSimilarLoading" class="shows-grid">
                                <div *ngFor="let similarEvent of similarEvents" class="mini-card"
                                    (click)="onSimilarEventClick(similarEvent)" tabindex="0">
                                    <div class="mini-poster"
                                        [style.background-image]="'url(' + (similarEvent.banner_image || 'assets/default-event.jpg') + ')'">
                                    </div>
                                    <div class="mini-title">{{ similarEvent.event_name }}</div>
                                    <div class="mini-sub muted">
                                        {{ formatDisplayDate(similarEvent.event_date) }}, {{ similarEvent.start_time }}
                                    </div>
                                    <div class="mini-sub">{{ similarEvent.location }}</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- RIGHT: Sidebar with Seat Selection -->
                <aside class="booking-sidebar">
                    <div class="sidebar-card" role="region" aria-label="ticket booking">
                        <div class="sidebar-header">
                            <div class="sidebar-poster">
                                <img [src]="eventDetails.banner_image || 'assets/default-event.jpg'"
                                    [alt]="eventDetails.event_name + ' poster'">
                            </div>
                            <div class="sidebar-info">
                                <div class="sidebar-title">{{ eventDetails.event_name }}</div>
                                <div class="sidebar-location muted">{{ eventDetails.location }}</div>
                            </div>
                        </div>

                        <div class="sidebar-details">
                            <!-- Date -->
                            <div class="info-row">
                                <div class="info-icon">üìÖ</div>
                                <div class="info-text">{{ formatDisplayDate(eventDetails.event_date) }}</div>
                            </div>

                            <!-- Time -->
                            <div class="info-row">
                                <div class="info-icon">‚è±</div>
                                <div class="info-text">
                                    {{ formatTimeForDisplay(eventDetails.start_time) }} -
                                    {{ formatTimeForDisplay(eventDetails.end_time) }}
                                </div>
                            </div>

                            <!-- Duration -->
                            <div class="info-row" *ngIf="eventDetails.total_duration_minutes">
                                <div class="info-icon">‚è∞</div>
                                <div class="info-text">{{ formatDuration(eventDetails.total_duration_minutes) }}</div>
                            </div>

                            <!-- Age Limit -->
                            <div class="info-row">
                                <div class="info-icon">üë•</div>
                                <div class="info-text">
                                    {{ eventDetails.age_limit ? eventDetails.age_limit + '+ years' : 'All age groups' }}
                                </div>
                            </div>

                            <!-- Language -->
                            <div class="info-row">
                                <div class="info-icon">üó£</div>
                                <div class="info-text">{{ eventDetails.language || 'English' }}</div>
                            </div>

                            <!-- Category -->
                            <div class="info-row" *ngIf="getEventCategoryName()">
                                <div class="info-icon">üé≠</div>
                                <div class="info-text">{{ getEventCategoryName() }}</div>
                            </div>

                            <!-- Location -->
                            <div class="info-row">
                                <div class="info-icon">üìç</div>
                                <div class="info-text">{{ eventDetails.full_address || eventDetails.location }}</div>
                            </div>

                            <!-- SEAT SELECTION SECTION - ABOVE PRICE ROW -->
                            <div class="seat-selection-section" *ngIf="seatTypes.length > 0">
                                <h4 class="seat-section-title">Select Seats</h4>
                                <p class="seat-section-sub">Check seats you want to book (max 10 tickets)</p>

                                <!-- Seat Type Cards with Checkboxes and Counters -->
                                <div *ngFor="let seatType of seatTypes" class="seat-card"
                                    [class.selected]="isSeatSelected(seatType.event_seat_type_inventory_id)">
                                    <div class="seat-checkbox-info">
                                        <label class="checkbox-container">
                                            <input type="checkbox"
                                                [checked]="isSeatSelected(seatType.event_seat_type_inventory_id)"
                                                (change)="toggleSeatSelection(seatType.event_seat_type_inventory_id, $event)">
                                            <span class="checkmark"></span>
                                        </label>
                                        <div class="seat-info">
                                            <div class="seat-name">{{ seatType.seat_name }}</div>
                                            <div class="seat-price">‚Çπ{{ seatType.price }}</div>
                                            <!-- <div class="seat-availability" [class.low]="seatType.available_seats < 10">
                                                {{ seatType.available_seats }} seats available
                                            </div> -->
                                        </div>
                                    </div>

                                    <!-- Quantity Counter - Only visible when checkbox is checked -->
                                    <div *ngIf="selectedSeats[seatType.event_seat_type_inventory_id] > 0"
                                        class="seat-qty">
                                        <button class="qty-btn"
                                            (click)="decreaseSeats(seatType.event_seat_type_inventory_id)">‚àí</button>
                                        <span class="qty-count">{{ selectedSeats[seatType.event_seat_type_inventory_id]
                                            }}</span>
                                        <button class="qty-btn"
                                            (click)="increaseSeats(seatType.event_seat_type_inventory_id)">+</button>
                                    </div>
                                </div>

                                <!-- Selected Seats Summary -->
                                <div *ngIf="hasSelectedSeats()" class="selected-summary">
                                    <h4>Selected Seats Summary</h4>
                                    <div *ngFor="let item of getSelectedSeatsList()" class="summary-item">
                                        <span>{{ item.seatType.seat_name }} √ó {{ item.quantity }}</span>
                                        <span>‚Çπ{{ item.seatType.price * item.quantity }}</span>
                                    </div>
                                    <div class="summary-total">
                                        <span>Total</span>
                                        <span>‚Çπ{{ totalAmount }}</span>
                                    </div>
                                </div>
                            </div>

                            <!-- Seat Types Loading -->
                            <div *ngIf="isSeatLoading" class="seat-loading">
                                <div class="loading-spinner-small">Loading seat options...</div>
                            </div>

                            <!-- Price and Book Button -->
                            <div class="price-row">
                                <div class="price-info">
                                    <div class="price">
                                        <!-- Display price based on selection or event price -->
                                        <span *ngIf="hasSelectedSeats()">
                                            ‚Çπ{{ totalAmount }}
                                        </span>
                                        <span *ngIf="!hasSelectedSeats()">
                                            {{ getDisplayPrice() }}{{ getPriceRangeDisplay() }}
                                        </span>
                                    </div>
                                    <div class="fill">Filling Fast</div>
                                </div>
                                <div class="book-action">
                                    <button class="book-btn" (click)="onBookNow()" [disabled]="!hasSelectedSeats()">
                                        Book Now
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </aside>
            </div>

            <!-- CTA -->
            <section class="cta-section">
                <div class="cta">
                    <p class="cta-text">List Your Show ‚Äî It's Free!</p>
                    <button class="cta-btn" (click)="navigateToSignUp()">Contact Us</button>
                </div>
            </section>
        </main>
        <footer class="events-footer">
            <div class="events-container">
                <div class="footer-content">
                    <img src="/assets/Zentro-logo.png" class="footer-logo" alt="Zentro Logo">
                    <div class="footer-links">
                        <span>List Your Event</span>
                        <span>|</span>
                        <span>Help & Support</span>
                        <span>|</span>
                        <span>Terms & Conditions</span>
                        <span>|</span>
                        <span>Privacy Policy</span>
                    </div>
                    <p class="copy">¬© 2025 Ticket House ‚Äì All rights reserved.</p>
                </div>
            </div>
        </footer>
    </div>

    <!-- Error State -->
    <div *ngIf="!isLoading && !eventDetails" class="error-container">
        <h2>Event Not Found</h2>
        <p>The event you're looking for doesn't exist or has been removed.</p>
        <button class="back-btn" (click)="router.navigate(['/events'])">Back to Events</button>
    </div>

    <!-- Modal for image preview -->
    <div class="modal" id="imgModal" role="dialog" aria-modal="true" aria-hidden="true">
        <div class="modal-close" id="modalClose" title="Close">‚úï</div>
        <div class="modal-inner" role="document">
            <img id="modalImage" src alt="Preview">
        </div>
    </div>

    <!-- Terms & Conditions Modal -->
    <div class="modal terms-modal" [class.open]="isTermsModalOpen" (click)="closeTermsModalOnBackdrop($event)">
        <div class="modal-content terms-modal-content" (click)="$event.stopPropagation()">
            <div class="modal-header">
                <h3>Terms & Conditions</h3>
                <button class="modal-close-btn" (click)="closeTermsModal()">‚úï</button>
            </div>
            <div class="modal-body terms-modal-body">
                <!-- Fixed: Added safe navigation operator and null check -->
                <div *ngIf="eventDetails?.terms_and_conditions; else noTerms" class="terms-content">
                    {{ eventDetails?.terms_and_conditions }}
                </div>
                <ng-template #noTerms>
                    <div class="terms-na">NA</div>
                </ng-template>
            </div>
        </div>
    </div>