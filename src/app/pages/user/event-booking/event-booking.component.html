<div class="audience-page audience-body">
    <!-- Events Header with Column Structure -->
    <!-- <header class="audience-header">
        <div class="container">
            <div class="header-row">
                <div class="header-col left-section-col">
                    <div class="left-section-content">
                        <div class="logo-wrapper">
                            <img class="logo" src="/assets/ticket-house-logo.jpeg" alt="ticket-house-logo" />
                        </div>
                        <div class="search-wrapper">
                            <div class="search">
                                <input placeholder="Search for Events, Artists, Location..." aria-label="search" />
                            </div>
                        </div>
                    </div>
                </div>
                <div class="header-col actions-col">
                    <div class="user-actions">
                        <div class="location muted">Pune ‚ñº</div>
                        <div class="pill" (click)="onSignIn()">Sign In</div>
                    </div>
                </div>
            </div>
        </div>
    </header> -->

    <!-- booking-page.component.html -->
    <!-- Loading State -->
    <div *ngIf="isLoading" class="loading-container">
        <div class="loading-spinner">Loading event details...</div>
    </div>

    <!-- Main Content -->
    <div *ngIf="!isLoading && eventDetails" class="booking-page">
        <main class="booking-container">
            <div class="booking-layout">
                <!-- LEFT: Main Content -->
                <div class="booking-main-content">
                    <!-- Hero Image -->
                    <!-- <div class="event-hero">
                        <div class="hero-img">
                            <img [src]="eventDetails.banner_image || 'https://images.unsplash.com/photo-1511671782779-c97d3d27a1d4?auto=format&fit=crop&w=1400&q=60'"
                                [alt]="eventDetails.event_name" (click)="openImageModal(eventDetails.banner_image)">
                        </div>
                    </div> -->
                    <!-- Hero Image - Updated to use EventDetailBanner -->
                    <div class="event-hero">
                        <div class="hero-img">
                            <img [src]="eventDetails.eventDetailBanner || eventDetails.banner_image || 'https://images.unsplash.com/photo-1511671782779-c97d3d27a1d4?auto=format&fit=crop&w=1400&q=60'"
                                [alt]="eventDetails.event_name"
                                (click)="openImageModal(eventDetails.eventDetailBanner || eventDetails.banner_image)">
                        </div>
                    </div>

                    <!-- Event Title -->
                    <h1 class="event-main-title">{{ eventDetails.event_name }}</h1>
                    <p class="event-category">{{ getEventCategoryName() || 'Stand-up Comedy' }}</p>

                    <!-- Event Info Grid -->
                    <!-- <div class="event-info-grid">
                        <div class="info-item">
                            <span class="info-icon">üìÖ</span>
                            <div class="info-content">
                                <div class="info-label">Date</div>
                                <div class="info-value">{{ formatDisplayDate(eventDetails.event_date) }}</div>
                            </div>
                        </div>

                        <div class="info-item">
                            <span class="info-icon">‚è∞</span>
                            <div class="info-content">
                                <div class="info-label">Time</div>
                                <div class="info-value">
                                    {{ formatTimeForDisplay(eventDetails.start_time) }} ‚Ä¢ {{
                                    formatDuration(eventDetails.total_duration_minutes) }}
                                </div>
                            </div>
                        </div>

                        <div class="info-item">
                            <span class="info-icon">üìç</span>
                            <div class="info-content">
                                <div class="info-label">Venue</div>
                                <div class="info-value">{{ eventDetails.full_address || eventDetails.location }}</div>
                            </div>
                        </div>
                    </div> -->

                    <!-- After event-category and before quick-info-section -->
                    <div class="event-details-section">
                        <div class="event-details-grid">
                            <div class="event-detail-item" (click)="onVenueLocationClick($event)"
                                [class.clickable-location]="hasLocationUrl()">
                                <span class="event-detail-icon">üìç</span>
                                <div class="event-detail-content">
                                    <div class="event-detail-label">Venue</div>
                                    <div class="event-detail-value">{{ eventDetails.full_address ||
                                        eventDetails.location }}</div>
                                </div>
                            </div>
                            <!-- <div class="d-flex" style="gap: 50px;">
                                <div class="event-detail-item">
                                    <span class="event-detail-icon">üìÖ</span>
                                    <div class="event-detail-content">
                                        <div class="event-detail-label">Date</div>
                                        <div class="event-detail-value">{{ formatDisplayDate(eventDetails.event_date) }}
                                        </div>
                                    </div>
                                </div>
                                <div class="event-detail-item">
                                    <span class="event-detail-icon">‚è∞</span>
                                    <div class="event-detail-content">
                                        <div class="event-detail-label">Time</div>
                                        <div class="event-detail-value">{{ formatTimeForDisplay(eventDetails.start_time)
                                            }}
                                            ‚Ä¢ {{ formatDuration(eventDetails.total_duration_minutes) }}</div>
                                    </div>
                                </div>
                            </div> -->
                            <div class="d-flex" style="gap: 50px;">
                                <div class="event-detail-item">
                                    <span class="event-detail-icon">
                                        <i class="bi bi-calendar3"></i>
                                    </span>
                                    <div class="event-detail-content">
                                        <div class="event-detail-label">Date</div>
                                        <div class="event-detail-value">{{ formatDisplayDate(eventDetails.event_date) }}
                                        </div>
                                    </div>
                                </div>
                                <div class="event-detail-item">
                                    <span class="event-detail-icon">
                                        <i class="bi bi-clock"></i>
                                    </span>
                                    <div class="event-detail-content">
                                        <div class="event-detail-label">Time</div>
                                        <div class="event-detail-value">{{ formatTimeForDisplay(eventDetails.start_time)
                                            }} ‚Ä¢ {{ formatDuration(eventDetails.total_duration_minutes) }}</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Quick Info Section -->
                    <div class="quick-info-section">
                        <!-- <h3 class="section-title-small">Quick Info</h3> -->
                        <div class="quick-info-grid">
                            <div class="quick-info-item">
                                <span class="quick-label">Duration:</span>
                                <span class="quick-value">{{ formatDuration(eventDetails.total_duration_minutes)
                                    }}</span>
                            </div>
                            <div class="quick-info-item">
                                <span class="quick-label">Language:</span>
                                <span class="quick-value">{{ eventDetails.language || 'Hindi' }}</span>
                            </div>
                            <div class="quick-info-item">
                                <span class="quick-label">Age Limit:</span>
                                <span class="quick-value">{{ eventDetails.age_limit ? eventDetails.age_limit + '+' :
                                    'All ages' }}</span>
                            </div>
                        </div>
                    </div>

                    <!-- About Section -->
                    <div class="about-section">
                        <h2 class="section-title">About the Event</h2>
                        <p class="about-text">{{ eventDetails.event_description }}</p>
                    </div>

                    <!-- Highlights Section (Add this if you have highlights data) -->
                    <div class="highlights-section" *ngIf="eventHighlights?.length">
                        <h2 class="section-title">Highlights</h2>
                        <ul class="highlights-list">
                            <li *ngFor="let highlight of eventHighlights">{{ highlight }}</li>
                        </ul>
                    </div>

                    <!-- Artist Section -->
                    <div class="artist-section" *ngIf="eventArtists?.length">
                        <h2 class="section-title">Artist</h2>
                        <div *ngFor="let artist of eventArtists" class="artist-info">
                            <h3 class="artist-name">{{ artist.name }}</h3>
                            <p class="artist-bio">{{ artist.bio }}</p>
                        </div>
                    </div>

                    <!-- Terms & Conditions -->
                    <div class="terms-row d-none" (click)="openTermsModal()">
                        <span class="terms-label">By proceeding, you agree to our Terms & Conditions</span>
                        <span class="terms-arrow">‚Ä∫</span>
                    </div>

                    <!-- Similar Shows Section -->
                    <div class="similar-shows" *ngIf="similarEvents.length > 0">
                        <h2 class="section-title">More Shows You Might Like</h2>

                        <div *ngIf="isSimilarLoading" class="loading-mini">Loading similar events...</div>

                        <div *ngIf="!isSimilarLoading" class="shows-grid">
                            <div *ngFor="let similarEvent of similarEvents" class="mini-card"
                                (click)="onSimilarEventClick(similarEvent)" tabindex="0">
                                <div class="mini-poster"
                                    [style.background-image]="'url(' + (similarEvent.banner_image || 'assets/default-event.jpg') + ')'">
                                </div>
                                <div class="mini-title">{{ similarEvent.event_name }}</div>
                                <div class="mini-sub">{{ formatDisplayDate(similarEvent.event_date) }}, {{
                                    similarEvent.start_time }}</div>
                                <!-- <div class="mini-sub location-text" [title]="similarEvent.location">{{
                                    similarEvent.location }}</div> -->
                                <div class="mini-sub location-text"
                                    (click)="onSimilarEventLocationClick($event, similarEvent)"
                                    [class.clickable]="hasSimilarEventLocationUrl(similarEvent)"
                                    [title]="similarEvent.location">
                                    <span class="location-icon"
                                        *ngIf="hasSimilarEventLocationUrl(similarEvent)">üìç</span>
                                    {{ similarEvent.location }}
                                </div>
                                <!-- Add price below location -->
                                <div class="mini-sub price">{{ getSimilarEventPrice(similarEvent) }}</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- RIGHT: Booking Sidebar -->
                <aside class="booking-sidebar">
                    <div class="sidebar-card sticky-sidebar">
                        <div class="sidebar-price-section">
                            <span class="sidebar-price-label" *ngIf="hasValidPrice()">Starting from</span>
                            <span class="sidebar-price-value">{{ getDisplayPrice() }}</span>
                            <span class="sidebar-price-range">{{ getPriceRangeDisplay() }}</span>
                        </div>
                        <!-- <button class="book-now-btn" (click)="onBookNow()">
                            Book Now <span class="btn-arrow">‚Ä∫</span>
                        </button> -->
                        <button class="book-now-btn" (click)="onBookNow()" [disabled]="!hasValidPrice()"
                            [class.disabled]="!hasValidPrice()">
                            {{ hasValidPrice() ? 'Book Now' : 'Sold Out' }}
                            <span class="btn-arrow" *ngIf="hasValidPrice()">‚Ä∫</span>
                        </button>
                        <!-- ADD THIS LINE - Terms & Conditions below book now button -->
                        <div class="terms-agreement">
                            <span class="terms-text">By proceeding, you agree to our </span>
                            <span class="terms-link" (click)="openTermsModal()">Terms & Conditions</span>
                        </div>
                    </div>
                </aside>
            </div>

            <!-- CTA Section -->
            <section class="cta-section">
                <div class="cta">
                    <p class="cta-text">List Your Show ‚Äî It's Free!</p>
                    <button class="cta-btn" (click)="navigateToSignUp()">Contact Us</button>
                </div>
            </section>
        </main>

        <!-- Add this right before the closing </main> tag or after the footer -->
        <div class="mobile-sticky-footer">
            <div class="mobile-footer-content">
                <div class="mobile-price-info">
                    <span class="mobile-price-label" *ngIf="hasValidPrice()">Starting from</span>
                    <span class="mobile-price-value">{{ getDisplayPrice() }}</span>
                    <span class="mobile-price-range">{{ getPriceRangeDisplay() }}</span>
                </div>
                <!-- <button class="mobile-book-btn" (click)="onBookNow()">
                    Book Now <span class="btn-arrow">‚Ä∫</span>
                </button> -->
                <button class="mobile-book-btn" (click)="onBookNow()" [disabled]="!hasValidPrice()"
                    [class.disabled]="!hasValidPrice()">
                    {{ hasValidPrice() ? 'Book Now' : 'Sold Out' }}
                    <span class="btn-arrow" *ngIf="hasValidPrice()">‚Ä∫</span>
                </button>
            </div>
        </div>

        <footer class="events-footer">
            <div class="events-container">
                <div class="footer-main">
                    <!-- Logo and Company Info -->
                    <div class="footer-col brand-col">
                        <img class="logo" src="/assets/th_transparent_logo.png" alt="ticket-house-logo" />
                        <p class="company-tagline">
                            Your one-stop destination for booking tickets to events, movies, and live shows.
                        </p>

                        <!-- Social Media Icons -->
                        <div class="social-icons d-none">
                            <a href="#" class="social-icon facebook" aria-label="Facebook">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"
                                    fill="currentColor">
                                    <path
                                        d="M9 8h-3v4h3v12h5v-12h3.642l.358-4h-4v-1.667c0-.955.192-1.333 1.115-1.333h2.885v-5h-3.808c-3.596 0-5.192 1.583-5.192 4.615v3.385z" />
                                </svg>
                            </a>
                            <a href="#" class="social-icon instagram" aria-label="Instagram">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"
                                    fill="currentColor">
                                    <path
                                        d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z" />
                                </svg>
                            </a>
                            <a href="#" class="social-icon youtube" aria-label="YouTube">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"
                                    fill="currentColor">
                                    <path
                                        d="M19.615 3.184c-3.604-.246-11.631-.245-15.23 0-3.897.266-4.356 2.62-4.385 8.816.029 6.185.484 8.549 4.385 8.816 3.6.245 11.626.246 15.23 0 3.897-.266 4.356-2.62 4.385-8.816-.029-6.185-.484-8.549-4.385-8.816zm-10.615 12.816v-8l8 3.993-8 4.007z" />
                                </svg>
                            </a>
                            <a href="#" class="social-icon twitter" aria-label="Twitter/X">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"
                                    fill="currentColor">
                                    <path
                                        d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z" />
                                </svg>
                            </a>
                        </div>
                    </div>

                    <!-- Quick Links -->
                    <div class="footer-col d-none">
                        <h4 class="footer-title">Quick Links</h4>
                        <ul class="footer-links-list">
                            <li><a href="#">Events</a></li>
                            <li><a href="#">Movies</a></li>
                            <li><a href="#">Live Shows</a></li>
                            <li><a href="#">Offers</a></li>
                        </ul>
                    </div>

                    <!-- Support -->
                    <div class="footer-col">
                        <h4 class="footer-title">Support</h4>
                        <ul class="footer-links-list">
                            <!-- <li><a href="#">Help & Support</a></li> -->
                            <!-- <li><a href="#">Terms & Conditions</a></li>
                            <li><a href="#">Privacy Policy</a></li>
                            <li><a href="#">Refund Policy</a></li> -->
                            <li><a (click)="openTermsConditions()" style="cursor: pointer;">Terms & Conditions</a></li>
                            <li><a (click)="openPrivacyPolicy()" style="cursor: pointer;">Privacy Policy</a></li>
                            <li><a (click)="openRefundPolicy()" style="cursor: pointer;">Refund Policy</a></li>
                        </ul>
                    </div>

                    <!-- Contact Us -->
                    <div class="footer-col">
                        <h4 class="footer-title">Contact Us</h4>
                        <ul class="footer-links-list contact-info">
                            <li><a href="mailto:support@tickethouse.in">support@tickethouse.com</a></li>
                            <!-- <li><a href="tel:1800123456">1800-123-456</a></li> -->
                        </ul>
                    </div>
                </div>

                <!-- Copyright -->
                <div class="footer-bottom">
                    <!-- <p class="copy">¬© 2026 Ticket House. All rights reserved.</p> -->
                    <p class="copy">
                        ¬© 2026 Zentro Technologies LLP. All Rights Reserved.
                        <span class="made-with">Made with <span class="heart">‚ô•</span></span>
                    </p>
                </div>
            </div>
        </footer>
    </div>


    <!-- Error State -->
    <div *ngIf="!isLoading && !eventDetails" class="error-container">
        <h2>Event Not Found</h2>
        <p>The event you're looking for doesn't exist or has been removed.</p>
        <button class="back-btn" (click)="router.navigate(['/events'])">Back to Events</button>
    </div>

    <!-- Modal for image preview -->
    <div class="modal" id="imgModal" role="dialog" aria-modal="true" aria-hidden="true">
        <div class="modal-close" id="modalClose" title="Close">‚úï</div>
        <div class="modal-inner" role="document">
            <img id="modalImage" src alt="Preview" />
        </div>
    </div>

    <!-- SEAT SELECTION MODAL (for logged-in users) -->
    <div class="modal seat-modal" [class.open]="isSeatModalOpen" (click)="closeSeatModalOnBackdrop($event)">
        <div class="modal-content seat-modal-content" (click)="$event.stopPropagation()">
            <div class="modal-header seat-modal-header">
                <h3>Select Tickets</h3>
                <button class="modal-close-btn" (click)="closeSeatModal()">‚úï</button>
            </div>

            <div class="modal-body seat-modal-body">
                <!-- Seat Types Loading -->
                <div *ngIf="isSeatLoading" class="seat-loading">
                    <div class="loading-spinner-small">Loading seat options...</div>
                </div>

                <!-- Seat Selection Section -->
                <!-- Seat Selection Section - Updated with clickable div -->
                <div class="seat-selection-section" *ngIf="!isSeatLoading && seatTypes.length > 0">
                    <!-- Seat Type Cards -->
                    <div *ngFor="let seatType of seatTypes" class="seat-card"
                        [class.selected]="isSeatSelected(seatType.event_seat_type_inventory_id)"
                        (click)="toggleSeatSelectionFromDiv(seatType.event_seat_type_inventory_id, $event)">
                        <div class="seat-info-main">
                            <label class="checkbox-container" (click)="$event.stopPropagation()">
                                <input type="checkbox" [checked]="isSeatSelected(seatType.event_seat_type_inventory_id)"
                                    (change)="toggleSeatSelection(seatType.event_seat_type_inventory_id, $event)">
                                <span class="checkmark"></span>
                            </label>
                            <div class="seat-details">
                                <div class="seat-name">{{ seatType.seat_name }}</div>
                                <div class="seat-price">‚Çπ{{ seatType.price }}</div>
                                <div class="seat-available sold-out" *ngIf="seatType.available_seats === 0">
                                    Sold Out
                                </div>
                            </div>
                        </div>

                        <!-- Quantity Counter -->
                        <div *ngIf="selectedSeats[seatType.event_seat_type_inventory_id] > 0" class="seat-qty"
                            (click)="$event.stopPropagation()">
                            <button class="qty-btn"
                                (click)="decreaseSeats(seatType.event_seat_type_inventory_id)">‚àí</button>
                            <span class="qty-count">{{ selectedSeats[seatType.event_seat_type_inventory_id] }}</span>
                            <button class="qty-btn"
                                (click)="increaseSeats(seatType.event_seat_type_inventory_id)">+</button>
                        </div>
                    </div>

                    <!-- Selected Seats Summary -->
                    <div *ngIf="hasSelectedSeats()" class="selected-summary">
                        <div *ngFor="let item of getSelectedSeatsList()" class="summary-item">
                            <span>{{ item.seatType.seat_name }} √ó {{ item.quantity }}</span>
                            <span>‚Çπ{{ item.seatType.price * item.quantity }}</span>
                        </div>
                        <div class="summary-total">
                            <span>Total</span>
                            <span>‚Çπ{{ totalAmount }}</span>
                        </div>
                    </div>

                    <div *ngIf="!hasSelectedSeats()" class="no-selection-message">
                        <p>Please select at least one ticket to proceed</p>
                    </div>
                </div>

                <!-- No Seat Types -->
                <div *ngIf="!isSeatLoading && seatTypes.length === 0" class="no-seats-message">
                    <p>No seat options available for this event</p>
                </div>
            </div>

            <div class="modal-footer seat-modal-footer">
                <button class="proceed-btn" (click)="proceedToCheckout()" [disabled]="!hasSelectedSeats()">
                    Proceed to Checkout <span class="btn-arrow">‚Ä∫</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Terms & Conditions Modal -->
    <div class="modal terms-modal" [class.open]="isTermsModalOpen" (click)="closeTermsModalOnBackdrop($event)">
        <div class="modal-content terms-modal-content" (click)="$event.stopPropagation()">
            <div class="modal-header">
                <h3>Terms & Conditions</h3>
                <button class="modal-close-btn" (click)="closeTermsModal()">‚úï</button>
            </div>
            <div class="modal-body terms-modal-body">
                <!-- Fixed: Added safe navigation operator and null check -->
                <div *ngIf="eventDetails?.terms_and_conditions; else noTerms" class="terms-content">
                    {{ eventDetails?.terms_and_conditions }}
                </div>
                <ng-template #noTerms>
                    <div class="terms-na">NA</div>
                </ng-template>
            </div>
        </div>
    </div>
</div>