<!-- MAIN CONTENT: Events Listing -->
<div class="main-content content-card">
  <!-- top row: title + add button -->
  <div class="page-header">
    <h2 class="page-title">Events Listing</h2>
    <div class="header-actions">
      <button class="btn btn-primary btn-add" data-bs-toggle="modal" data-bs-target="#addEventModal"
        (click)="resetFormAndOpenModal()">
        <i class="fa fa-plus"></i>&nbsp; Add Event
      </button>
    </div>
  </div>

  <!-- Filters Section -->
  <!-- <div class="card card-white mb-3">
    <div class="card-body">
      <div class="row g-3">
        <div class="col-md-3">
          <input type="text" class="form-control" [(ngModel)]="searchText" placeholder="Search events..."
            (keyup.enter)="onSearch()" />
        </div>
        <div class="col-md-2">
          <select class="form-control" [(ngModel)]="statusFilter" (change)="onSearch()">
            <option value="">All Status</option>
            <option value="active">Active</option>
            <option value="inactive">Inactive</option>
          </select>
        </div>
        <div class="col-md-2">
          <input type="date" class="form-control" [(ngModel)]="fromDate" (change)="onSearch()"
            placeholder="From Date" />
        </div>
        <div class="col-md-2">
          <input type="date" class="form-control" [(ngModel)]="toDate" (change)="onSearch()" placeholder="To Date" />
        </div>
        <div class="col-md-3">
          <button class="btn btn-primary me-2" (click)="onSearch()">
            <i class="fa fa-search"></i> Search
          </button>
          <button class="btn btn-secondary" (click)="clearFilters()">
            <i class="fa fa-times"></i> Clear
          </button>
        </div>
      </div>
    </div>
  </div> -->

  <!-- Events Listing Table -->
  <div class="card card-white">
    <div class="table-responsive">
      <table class="table list-table">
        <thead>
          <tr>
            <th class="col-sr">Sr. No</th>
            <th class="col-name">Event Name</th>
            <th class="col-desc">Description</th>
            <th class="col-date">Event Date</th>
            <th class="col-time">Time</th>
            <th class="col-duration">Duration</th>
            <th class="col-location">Location</th>
            <th class="col-status text-center">Status</th>
            <th class="col-action text-center">Action</th>
          </tr>
        </thead>
        <tbody>
          <!-- In the table row: -->
          <tr *ngFor="let event of events; let i = index">
            <td>{{ (currentPage - 1) * pageSize + i + 1 }}</td>
            <td>
              <!-- <div class="event-name-with-media">
                <div class="event-banner-small" *ngIf="event.eventDetails.banner_image">
                  <img
                    [src]="event.eventDetails.banner_image"
                    [alt]="event.eventDetails.event_name"
                    class="banner-img"
                  />
                </div>
                <div class="event-banner-small" *ngIf="!event.eventDetails.banner_image">
                  <div class="banner-placeholder">
                    <i class="fa fa-image"></i>
                  </div>
                </div>
                <span>{{ event.eventDetails.event_name }}</span>
              </div> -->
              {{ event.eventDetails.event_name }}
            </td>
            <td>
              {{ event.eventDetails.event_description | slice : 0 : 100
              }}{{ event.eventDetails.event_description.length > 100 ? '...' : '' }}
            </td>
            <td>{{ event.eventDetails.event_date | date : 'dd MMM yyyy' }}</td>
            <td>{{ event.eventDetails.start_time }} - {{ event.eventDetails.end_time }}</td>
            <td>{{ event.eventDetails.total_duration_minutes }} mins</td>
            <td>{{ event.eventDetails.location }}</td>
            <td class="text-center">
              <span [ngClass]="{
                  'status-badge status-active': event.eventDetails.status === 'active',
                  'status-badge status-inactive': event.eventDetails.status === 'inactive',
                  'status-badge status-draft': event.eventDetails.status === 'draft'
                }">
                {{ event.eventDetails.status | titlecase }}
              </span>
            </td>
            <td class="text-center">
              <!-- Update these click handlers too -->
              <!-- <button class="icon-btn me-1" title="View" (click)="viewEvent(event.eventDetails.event_id)">
                <i class="fa fa-eye"></i>
              </button> -->
              <button class="icon-btn me-1" title="Edit" (click)="editEvent(event)">
                <i class="fa fa-pen"></i>
              </button>
              <button class="icon-btn danger" title="Delete" (click)="deleteEvent(event.eventDetails.event_id)">
                <i class="fa fa-trash"></i>
              </button>
              <!-- Info/Summary Icon Button - Add this -->
              <button class="icon-btn info me-1" title="View Event Summary" (click)="viewEventSummary(event.eventDetails.event_id)">
                <i class="fa fa-info-circle"></i>
              </button>
            </td>
          </tr>
          <tr *ngIf="events.length === 0">
            <td colspan="9" class="text-center py-4">No events found. Create your first event!</td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- pagination footer -->
    <div class="table-footer">
      <!-- Left side: Per page options -->
      <div class="per-page-options">
        <span class="show-label">Show:</span>
        <select class="per-page-select" [(ngModel)]="pageSize" (change)="onPageSizeChange()">
          <option value="5">5 entries</option>
          <option value="10">10 entries</option>
          <option value="50">50 entries</option>
          <option value="100">100 entries</option>
        </select>
        <span class="entries-count" *ngIf="totalEvents > 0">
          Showing {{ (currentPage - 1) * pageSize + 1 }} to
          {{ getMinValue(currentPage * pageSize, totalEvents) }} of {{ totalEvents }} entries
        </span>
        <span class="entries-count" *ngIf="totalEvents === 0">
          Showing 0 entries
        </span>
      </div>

      <!-- Right side: Pagination - Always show if there are events -->
      <nav aria-label="Page navigation" *ngIf="events.length > 0">
        <ul class="pagination">
          <li class="page-item" [class.disabled]="currentPage === 1">
            <a class="page-link" href="javascript:void(0)" (click)="goToPage(currentPage - 1)">Prev</a>
          </li>
          <li *ngFor="let page of getPageNumbers()" class="page-item" [class.active]="page === currentPage">
            <a class="page-link" href="javascript:void(0)" (click)="goToPage(page)">{{ page }}</a>
          </li>
          <li class="page-item" [class.disabled]="currentPage === totalPages">
            <a class="page-link" href="javascript:void(0)" (click)="goToPage(currentPage + 1)">Next</a>
          </li>
        </ul>
      </nav>
      
      <!-- Show placeholder when no events -->
      <div class="pagination-placeholder" *ngIf="events.length === 0">
        <span class="text-muted">No events to display</span>
      </div>
    </div>
  </div>
</div>

<!-- ADD EVENT MODAL -->
<div class="modal fade" id="addEventModal" tabindex="-1" aria-labelledby="addEventLabel" aria-hidden="true">
  <div class="modal-dialog modal-xl modal-dialog-centered modal-dialog-scrollable">
    <div class="modal-content modal-card">
      <div class="modal-header">
        <h5 class="modal-title" id="addEventLabel">Add New Event</h5>
        <button type="button" class="btn-close" aria-label="Close" (click)="closeModalProperly('addEventModal')"></button>
      </div>

      <div class="modal-body">
        <form class="event-form" (ngSubmit)="createEvent()">
          <!-- Basic Information Section -->
          <div class="form-section">
            <h6 class="section-title">Basic Information</h6>
            <div class="form-grid">
              <div class="form-row">
                <label>Event Name *</label>
                <input type="text" class="form-control" [(ngModel)]="eventForm.event_name" name="eventName" required />
              </div>

              <div class="form-row">
                <label>Event Category *</label>
                <select class="form-control" [(ngModel)]="eventForm.event_category_id" name="eventCategory" required>
                  <option value="">Select Category</option>
                  <!-- Loading State -->
                  <option *ngIf="isLoadingCategories" value="" disabled>
                    Loading categories...
                  </option>
                  <!-- No Categories State -->
                  <option *ngIf="!isLoadingCategories && categories.length === 0" value="" disabled>
                    No categories available
                  </option>
                  <!-- Categories List -->
                  <option *ngFor="let category of categories" [value]="category.event_category_id">
                    {{ category.event_category_name }}
                  </option>
                </select>
                <small *ngIf="isLoadingCategories" class="text-muted mt-1">
                  <i class="fa fa-spinner fa-spin"></i> Loading categories...
                </small>
                <small *ngIf="!isLoadingCategories && categories.length === 0" class="text-warning mt-1">
                  No event categories found. Please add categories first.
                </small>
              </div>

              <div class="form-row full-width">
                <label>Event Description *</label>
                <textarea class="form-control" rows="4" [(ngModel)]="eventForm.event_description"
                  name="eventDescription" required></textarea>
              </div>

              <!-- <div class="form-row">
                <label>No. of Seats</label>
                <input
                  type="number"
                  class="form-control"
                  [(ngModel)]="eventForm.no_of_seats"
                  name="noOfSeats"
                  placeholder="e.g., 100"
                />
              </div> -->
            </div>
          </div>

          <!-- Date & Time Section -->
          <div class="form-section">
            <h6 class="section-title">Date & Time</h6>
            <div class="form-grid">
              <div class="form-row">
                <label>Event Date *</label>
                <input type="date" class="form-control" [(ngModel)]="eventForm.event_date" name="eventDate" required
                  (change)="calculateDuration()" />
              </div>

              <div class="form-row">
                <label>Start Time *</label>
                <input type="time" class="form-control" [(ngModel)]="eventForm.start_time" name="startTime" required
                  (change)="calculateDuration()" />
              </div>

              <div class="form-row">
                <label>End Time *</label>
                <input type="time" class="form-control" [(ngModel)]="eventForm.end_time" name="endTime" required
                  (change)="calculateDuration()" />
              </div>

              <div class="form-row">
                <label>Total Duration (minutes) *</label>
                <input type="number" class="form-control" [(ngModel)]="eventForm.total_duration_minutes"
                  name="totalDuration" required readonly />
              </div>
            </div>
          </div>

          <!-- Location Information Section -->
          <div class="form-section">
            <h6 class="section-title">Location Information</h6>
            <div class="form-grid">
              <div class="form-row">
                <label>Location *</label>
                <input type="text" class="form-control" [(ngModel)]="eventForm.location" name="location"
                  placeholder="e.g., Central Park" required />
              </div>

              <div class="form-row">
                <label>Language *</label>
                <select class="form-control" [(ngModel)]="eventForm.language" name="language" required>
                  <!-- <option value="english">English</option>
                  <option value="spanish">Spanish</option>
                  <option value="french">French</option>
                  <option value="german">German</option> -->
                  <option value="marathi">Marathi</option>
                  <option value="hindi">Hindi</option>
                  <option value="english">English</option>
                </select>
              </div>

              <div class="form-row full-width">
                <label>Full Address *</label>
                <textarea class="form-control" rows="3" [(ngModel)]="eventForm.full_address" name="fullAddress"
                  required></textarea>
              </div>

              <div class="form-row">
                <label>Google Maps URL</label>
                <input type="url" class="form-control" [(ngModel)]="eventForm.geo_map_url" name="geoMapUrl" />
              </div>

              <div class="form-row">
                <label>Latitude</label>
                <input type="number" step="any" class="form-control" [(ngModel)]="eventForm.latitude" name="latitude" />
              </div>

              <div class="form-row">
                <label>Longitude</label>
                <input type="number" step="any" class="form-control" [(ngModel)]="eventForm.longitude"
                  name="longitude" />
              </div>
            </div>
          </div>

          <!-- Artists Section -->
          <div class="form-section">
            <h6 class="section-title">Artists</h6>
            <div class="form-grid">
              <div class="form-row full-width">
                <label>Add Artists</label>
                <div class="artist-input-group mb-3">
                  <div class="input-group">
                    <input type="text" class="form-control" [(ngModel)]="newArtistName" name="newArtistName"
                      placeholder="Artist Name" />
                    <input #artistPhotoInput type="file" class="form-control" id="artistPhotoInput" accept="image/*"
                      (change)="onArtistPhotoSelected($event)" hidden />
                    <button class="btn btn-outline-secondary" type="button" (click)="triggerFileInput()">
                      <i class="fa fa-upload"></i> Choose Photo
                    </button>
                    <button class="btn btn-primary" type="button" (click)="addArtist()" [disabled]="isUploadingArtist">
                      <i class="fa fa-plus"></i> {{ isUploadingArtist ? 'Uploading...' : 'Add' }}
                    </button>
                  </div>
                  <small class="text-muted">Max file size: 2MB | Allowed types: JPG, PNG, GIF</small>
                </div>

                <!-- Artists List -->
                <div class="artists-list" *ngIf="artists.length > 0">
                  <h6>Added Artists ({{ artists.length }})</h6>
                  <div class="list-group">
                    <div class="list-group-item" *ngFor="let artist of artists; let i = index">
                      <div class="d-flex justify-content-between align-items-center">
                        <div class="d-flex align-items-center">
                          <img [src]="artist.artist_photo" [alt]="artist.artist_name" class="artist-thumb me-3"
                            style="width: 40px; height: 40px; object-fit: cover; border-radius: 4px"
                            onerror="this.src='assets/images/default-artist.png'" />
                          <span>{{ artist.artist_name }}</span>
                        </div>
                        <button type="button" class="btn btn-sm btn-danger" (click)="removeArtist(i)">
                          <i class="fa fa-trash"></i>
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Gallery Section -->
          <div class="form-section">
            <h6 class="section-title">Gallery Images</h6>
            <div class="form-grid">
              <div class="form-row full-width">
                <label>Add Gallery Images</label>
                <div class="gallery-input-group mb-3">
                  <input type="file" class="form-control" accept="image/*" multiple
                    (change)="onGalleryImageSelected($event)" [disabled]="isUploadingGallery" />
                  <small class="text-muted">Max file size: 2MB per image | Allowed types: JPG, PNG, GIF | Multiple
                    selection allowed</small>
                  <div *ngIf="isUploadingGallery" class="text-info mt-1">
                    <i class="fa fa-spinner fa-spin"></i> Uploading images...
                  </div>
                </div>

                <!-- Gallery Preview -->
                <div class="gallery-preview" *ngIf="galleries.length > 0">
                  <h6>Gallery Images ({{ galleries.length }})</h6>
                  <div class="row row-cols-3 g-2">
                    <div class="col" *ngFor="let gallery of galleries; let i = index">
                      <div class="gallery-item position-relative">
                        <img [src]="gallery.event_img" class="img-fluid rounded"
                          style="height: 100px; width: 100%; object-fit: cover"
                          onerror="this.src='assets/images/default-gallery.png'" />
                        <button type="button" class="btn btn-sm btn-danger position-absolute top-0 end-0 m-1"
                          (click)="removeGallery(i)">
                          <i class="fa fa-times"></i>
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Banner Section -->
          <div class="form-section">
            <h6 class="section-title">Event Banner</h6>
            <div class="form-grid">
              <div class="form-row full-width">
                <label>Upload Banner Image</label>
                <div class="banner-input-group mb-3">
                  <input type="file" class="form-control" accept="image/*" (change)="onBannerSelected($event)" />
                  <small class="text-muted">Recommended size: 1200x400px | Max file size: 5MB | Allowed types: JPG, PNG,
                    GIF, WEBP</small>
                  <div *ngIf="isUploadingBanner" class="text-info mt-1">
                    <i class="fa fa-spinner fa-spin"></i> Uploading banner...
                  </div>
                </div>

                <!-- Banner Preview -->
                <div *ngIf="bannerPreviewUrl" class="banner-preview mb-3">
                  <h6>Banner Preview</h6>
                  <img [src]="bannerPreviewUrl" class="img-fluid rounded" style="max-height: 200px" />
                  <button type="button" class="btn btn-sm btn-danger ms-4" (click)="clearBannerPreview()">
                    <i class="fa fa-times"></i> Remove
                  </button>
                </div>

                <!-- Existing Banner -->
                <div *ngIf="eventForm.banner_image && !bannerPreviewUrl" class="existing-banner mb-3">
                  <h6>Current Banner</h6>
                  <img [src]="eventForm.banner_image" class="img-fluid rounded" style="max-height: 200px"
                    onerror="this.src='assets/images/default-banner.png'" />
                </div>
              </div>
            </div>
          </div>

          <!-- Add this section after Gallery Section in the modal -->
          <div class="form-section">
            <h6 class="section-title">Seat Types & Pricing</h6>
            <div class="form-grid">
              <div class="form-row full-width">
                <label>Add Seat Types</label>
                <div class="seat-type-input-group mb-3">
                  <div class="input-group mb-2">
                    <input type="text" class="form-control" [(ngModel)]="newSeatType.seat_name" name="newSeatName"
                      placeholder="Seat Name (e.g., VIP, Gold, Silver)" style="max-width: 200px;" />
                    <input type="number" class="form-control" [(ngModel)]="newSeatType.price" name="newSeatPrice"
                      placeholder="Price per seat" min="0" step="0.01" style="max-width: 150px;" />
                    <input type="number" class="form-control" [(ngModel)]="newSeatType.total_seats" name="newSeatTotal"
                      placeholder="Total Seats" min="1" style="max-width: 150px;" />
                    <button class="btn btn-primary" type="button" (click)="addSeatType()"
                      [disabled]="!isValidSeatType()">
                      <i class="fa fa-plus"></i> Add Seat Type
                    </button>
                  </div>
                  <small class="text-muted">Add different seat types with pricing and capacity</small>
                </div>

                <!-- Seat Types List -->
                <div class="seat-types-list" *ngIf="seatTypes.length > 0">
                  <h6>Added Seat Types ({{ seatTypes.length }})</h6>
                  <div class="table-responsive">
                    <table class="table table-sm table-bordered">
                      <thead>
                        <tr>
                          <th>Seat Name</th>
                          <th>Price (₹)</th>
                          <th>Total Seats</th>
                          <th>Available</th>
                          <th>Action</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr *ngFor="let seatType of seatTypes; let i = index">
                          <td>{{ seatType.seat_name }}</td>
                          <td>₹{{ seatType.price | number:'1.2-2' }}</td>
                          <td>{{ seatType.total_seats }}</td>
                          <td>{{ seatType.available_seats || seatType.total_seats }}</td>
                          <td>
                            <button type="button" class="btn btn-sm btn-danger" (click)="removeSeatType(i)">
                              <i class="fa fa-trash"></i>
                            </button>
                          </td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Additional Information -->
          <div class="form-section">
            <h6 class="section-title">Additional Information</h6>
            <div class="form-grid">
              <div class="form-row">
                <label>Age Limit</label>
                <input type="number" class="form-control" [(ngModel)]="eventForm.age_limit" name="ageLimit" />
              </div>

              <div class="form-row">
                <label>Status *</label>
                <select class="form-control" [(ngModel)]="eventForm.status" name="status" required>
                  <!-- <option value="draft">Draft</option> -->
                  <option value="active">Active</option>
                  <option value="inactive">Inactive</option>
                </select>
              </div>

              <!-- <div class="form-row">
                <label>Minimum Price ($)</label>
                <input type="number" step="0.01" class="form-control" [(ngModel)]="eventForm.min_price"
                  name="minPrice" />
              </div>

              <div class="form-row">
                <label>Maximum Price ($)</label>
                <input type="number" step="0.01" class="form-control" [(ngModel)]="eventForm.max_price"
                  name="maxPrice" />
              </div> -->

              <div class="form-row full-width">
                <label>Terms & Conditions</label>
                <textarea class="form-control" rows="4" [(ngModel)]="eventForm.terms_and_conditions"
                  name="termsAndConditions"></textarea>
              </div>
            </div>
          </div>

          <!-- Settings Section -->
          <div class="form-section">
            <h6 class="section-title">Settings</h6>
            <div class="form-grid">
              <div class="form-row">
                <div class="checkbox-group">
                  <label class="checkbox-label">
                    <input type="checkbox" class="form-checkbox" [(ngModel)]="eventForm.is_featured"
                      name="isFeatured" />
                    <span class="checkmark"></span>
                    Featured Event
                  </label>
                  <span class="checkbox-hint">Show this event as featured on homepage</span>
                </div>
              </div>

              <!-- <div class="form-row">
                <label>Status *</label>
                <select class="form-control" [(ngModel)]="eventForm.status" name="status" required>
                  <option value="active">Active</option>
                  <option value="inactive">Inactive</option>
                </select>
              </div> -->
            </div>
          </div>
        </form>
      </div>

      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" (click)="closeModalProperly('addEventModal')">
          Cancel
        </button>
        <button type="button" class="btn btn-primary btn-modal-add" (click)="createEvent()" [disabled]="isSubmitting">
          <i class="fa fa-plus"></i> {{ isSubmitting ? 'Creating...' : 'Create Event' }}
        </button>
      </div>
    </div>
  </div>
</div>

<!-- EDIT EVENT MODAL -->
<div class="modal fade" id="editEventModal" tabindex="-1" aria-labelledby="editEventLabel" aria-hidden="true">
  <div class="modal-dialog modal-xl modal-dialog-centered modal-dialog-scrollable">
    <div class="modal-content modal-card">
      <div class="modal-header">
        <h5 class="modal-title" id="editEventLabel">Edit Event</h5>
        <button type="button" class="btn-close" aria-label="Close" (click)="closeModalProperly('editEventModal')"></button>
      </div>

      <div class="modal-body">
        <form class="event-form" (ngSubmit)="updateEvent()">
          <!-- Basic Information Section -->
          <div class="form-section">
            <h6 class="section-title">Basic Information</h6>
            <div class="form-grid">
              <div class="form-row">
                <label>Event Name *</label>
                <input type="text" class="form-control" [(ngModel)]="eventForm.event_name" name="eventName" required />
              </div>

              <div class="form-row">
                <label>Event Category *</label>
                <select class="form-control" [(ngModel)]="eventForm.event_category_id" name="eventCategory" required>
                  <option value="">Select Category</option>
                  <!-- Loading State -->
                  <option *ngIf="isLoadingCategories" value="" disabled>
                    Loading categories...
                  </option>
                  <!-- No Categories State -->
                  <option *ngIf="!isLoadingCategories && categories.length === 0" value="" disabled>
                    No categories available
                  </option>
                  <!-- Categories List -->
                  <option *ngFor="let category of categories" [value]="category.event_category_id"
                    [selected]="category.event_category_id === eventForm.event_category_id">
                    {{ category.event_category_name }}
                  </option>
                </select>
                <small *ngIf="isLoadingCategories" class="text-muted mt-1">
                  <i class="fa fa-spinner fa-spin"></i> Loading categories...
                </small>
                <small *ngIf="!isLoadingCategories && categories.length === 0" class="text-warning mt-1">
                  No event categories found. Please add categories first.
                </small>
              </div>

              <div class="form-row full-width">
                <label>Event Description *</label>
                <textarea class="form-control" rows="4" [(ngModel)]="eventForm.event_description"
                  name="eventDescription" required></textarea>
              </div>

              <!-- <div class="form-row">
                <label>No. of Seats</label>
                <input type="number" class="form-control" [(ngModel)]="eventForm.no_of_seats" name="noOfSeats"
                  placeholder="e.g., 100" />
              </div> -->
            </div>
          </div>

          <!-- Date & Time Section -->
          <div class="form-section">
            <h6 class="section-title">Date & Time</h6>
            <div class="form-grid">
              <div class="form-row">
                <label>Event Date *</label>
                <input type="date" class="form-control" [(ngModel)]="eventForm.event_date" name="eventDate" required
                  (change)="calculateDuration()" />
              </div>

              <div class="form-row">
                <label>Start Time *</label>
                <input type="time" class="form-control" [(ngModel)]="eventForm.start_time" name="startTime" required
                  (change)="calculateDuration()" />
              </div>

              <div class="form-row">
                <label>End Time *</label>
                <input type="time" class="form-control" [(ngModel)]="eventForm.end_time" name="endTime" required
                  (change)="calculateDuration()" />
              </div>

              <div class="form-row">
                <label>Total Duration (minutes) *</label>
                <input type="number" class="form-control" [(ngModel)]="eventForm.total_duration_minutes"
                  name="totalDuration" required readonly />
              </div>
            </div>
          </div>

          <!-- Location Information Section -->
          <div class="form-section">
            <h6 class="section-title">Location Information</h6>
            <div class="form-grid">
              <div class="form-row">
                <label>Location *</label>
                <input type="text" class="form-control" [(ngModel)]="eventForm.location" name="location"
                  placeholder="e.g., Central Park" required />
              </div>

              <div class="form-row">
                <label>Language *</label>
                <select class="form-control" [(ngModel)]="eventForm.language" name="language" required>
                  <!-- <option value="english" [selected]="eventForm.language === 'english'">
                    English
                  </option>
                  <option value="spanish" [selected]="eventForm.language === 'spanish'">
                    Spanish
                  </option>
                  <option value="french" [selected]="eventForm.language === 'french'">
                    French
                  </option>
                  <option value="german" [selected]="eventForm.language === 'german'">
                    German
                  </option> -->
                  <option value="english" [selected]="eventForm.language === 'marathi'">Marathi</option>
                  <option value="hindi" [selected]="eventForm.language === 'hindi'">Hindi</option>
                  <option value="english" [selected]="eventForm.language === 'english'">English</option>
                </select>
              </div>

              <div class="form-row full-width">
                <label>Full Address *</label>
                <textarea class="form-control" rows="3" [(ngModel)]="eventForm.full_address" name="fullAddress"
                  required></textarea>
              </div>

              <div class="form-row">
                <label>Google Maps URL</label>
                <input type="url" class="form-control" [(ngModel)]="eventForm.geo_map_url" name="geoMapUrl" />
              </div>

              <div class="form-row">
                <label>Latitude</label>
                <input type="number" step="any" class="form-control" [(ngModel)]="eventForm.latitude" name="latitude" />
              </div>

              <div class="form-row">
                <label>Longitude</label>
                <input type="number" step="any" class="form-control" [(ngModel)]="eventForm.longitude"
                  name="longitude" />
              </div>
            </div>
          </div>

          <!-- Artists Section -->
          <div class="form-section">
            <h6 class="section-title">Artists</h6>
            <div class="form-grid">
              <div class="form-row full-width">
                <label>Add Artists</label>
                <div class="artist-input-group mb-3">
                  <div class="input-group">
                    <input type="text" class="form-control" [(ngModel)]="newArtistName" name="newArtistName"
                      placeholder="Artist Name" />
                    <input #artistPhotoInputEdit type="file" class="form-control" id="artistPhotoInputEdit"
                      accept="image/*" (change)="onArtistPhotoSelected($event)" hidden />
                    <button class="btn btn-outline-secondary" type="button" (click)="triggerFileInputEdit()">
                      <i class="fa fa-upload"></i> Choose Photo
                    </button>
                    <button class="btn btn-primary" type="button" (click)="addArtist()" [disabled]="isUploadingArtist">
                      <i class="fa fa-plus"></i> {{ isUploadingArtist ? 'Uploading...' : 'Add' }}
                    </button>
                  </div>
                  <small class="text-muted">Max file size: 2MB | Allowed types: JPG, PNG, GIF</small>
                </div>

                <!-- Artists List -->
                <div class="artists-list" *ngIf="artists.length > 0">
                  <h6>Added Artists ({{ artists.length }})</h6>
                  <div class="list-group">
                    <div class="list-group-item" *ngFor="let artist of artists; let i = index">
                      <div class="d-flex justify-content-between align-items-center">
                        <div class="d-flex align-items-center">
                          <img [src]="artist.artist_photo" [alt]="artist.artist_name" class="artist-thumb me-3"
                            style="width: 40px; height: 40px; object-fit: cover; border-radius: 4px"
                            onerror="this.src='assets/images/default-artist.png'" />
                          <span>{{ artist.artist_name }}</span>
                        </div>
                        <button type="button" class="btn btn-sm btn-danger" (click)="removeArtist(i)">
                          <i class="fa fa-trash"></i>
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Gallery Section -->
          <div class="form-section">
            <h6 class="section-title">Gallery Images</h6>
            <div class="form-grid">
              <div class="form-row full-width">
                <label>Add Gallery Images</label>
                <div class="gallery-input-group mb-3">
                  <input type="file" class="form-control" accept="image/*" multiple
                    (change)="onGalleryImageSelected($event)" [disabled]="isUploadingGallery" />
                  <small class="text-muted">Max file size: 2MB per image | Allowed types: JPG, PNG, GIF | Multiple
                    selection allowed</small>
                  <div *ngIf="isUploadingGallery" class="text-info mt-1">
                    <i class="fa fa-spinner fa-spin"></i> Uploading images...
                  </div>
                </div>

                <!-- Gallery Preview -->
                <div class="gallery-preview" *ngIf="galleries.length > 0">
                  <h6>Gallery Images ({{ galleries.length }})</h6>
                  <div class="row row-cols-3 g-2">
                    <div class="col" *ngFor="let gallery of galleries; let i = index">
                      <div class="gallery-item position-relative">
                        <img [src]="gallery.event_img" class="img-fluid rounded"
                          style="height: 100px; width: 100%; object-fit: cover"
                          onerror="this.src='assets/images/default-gallery.png'" />
                        <button type="button" class="btn btn-sm btn-danger position-absolute top-0 end-0 m-1"
                          (click)="removeGallery(i)">
                          <i class="fa fa-times"></i>
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Banner Section -->
          <div class="form-section">
            <h6 class="section-title">Event Banner</h6>
            <div class="form-grid">
              <div class="form-row full-width">
                <label>Upload Banner Image</label>
                <div class="banner-input-group mb-3">
                  <input type="file" class="form-control" accept="image/*" (change)="onBannerSelected($event)" />
                  <small class="text-muted">Recommended size: 1200x400px | Max file size: 5MB | Allowed types: JPG, PNG,
                    GIF, WEBP</small>
                  <div *ngIf="isUploadingBanner" class="text-info mt-1">
                    <i class="fa fa-spinner fa-spin"></i> Uploading banner...
                  </div>
                </div>

                <!-- Banner Preview -->
                <div *ngIf="bannerPreviewUrl" class="banner-preview mb-3">
                  <h6>Banner Preview</h6>
                  <img [src]="bannerPreviewUrl" class="img-fluid rounded" style="max-height: 200px" />
                  <button type="button" class="btn btn-sm btn-danger mt-2" (click)="clearBannerPreview()">
                    <i class="fa fa-times"></i> Remove
                  </button>
                </div>

                <!-- Existing Banner -->
                <div *ngIf="eventForm.banner_image && !bannerPreviewUrl" class="existing-banner mb-3">
                  <h6>Current Banner</h6>
                  <img [src]="eventForm.banner_image" class="img-fluid rounded" style="max-height: 200px"
                    onerror="this.src='assets/images/default-banner.png'" />
                </div>
              </div>
            </div>
          </div>

          <!-- Add this after the Banner Section -->
          <div class="form-section">
            <h6 class="section-title">Seat Types & Pricing</h6>
            <div class="form-grid">
              <div class="form-row full-width">
                <label>Add Seat Types</label>
                <div class="seat-type-input-group mb-3">
                  <div class="input-group mb-2">
                    <input type="text" class="form-control" [(ngModel)]="newSeatType.seat_name" name="newSeatName"
                      placeholder="Seat Name (e.g., VIP, Gold, Silver)" style="max-width: 200px;" />
                    <input type="number" class="form-control" [(ngModel)]="newSeatType.price" name="newSeatPrice"
                      placeholder="Price per seat" min="0" step="0.01" style="max-width: 150px;" />
                    <input type="number" class="form-control" [(ngModel)]="newSeatType.total_seats" name="newSeatTotal"
                      placeholder="Total Seats" min="1" style="max-width: 150px;" />
                    <button class="btn btn-primary" type="button" (click)="addSeatType()"
                      [disabled]="!isValidSeatType()">
                      <i class="fa fa-plus"></i> Add Seat Type
                    </button>
                  </div>
                  <small class="text-muted">Add different seat types with pricing and capacity</small>
                </div>

                <!-- Seat Types List -->
                <div class="seat-types-list" *ngIf="seatTypes.length > 0">
                  <h6>Current Seat Types ({{ seatTypes.length }})</h6>
                  <div class="table-responsive">
                    <table class="table table-sm table-bordered">
                      <thead>
                        <tr>
                          <th>Seat Name</th>
                          <th>Price (₹)</th>
                          <th>Total Seats</th>
                          <!-- <th>Available</th> -->
                          <th>Action</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr *ngFor="let seatType of seatTypes; let i = index">
                          <td>{{ seatType.seat_name }}</td>
                          <td>₹{{ seatType.price | number:'1.2-2' }}</td>
                          <td>{{ seatType.total_seats }}</td>
                          <!-- <td>{{ seatType.available_seats || seatType.total_seats }}</td> -->
                          <td>
                            <button type="button" class="btn btn-sm btn-danger" (click)="removeSeatType(i)">
                              <i class="fa fa-trash"></i>
                            </button>
                          </td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Additional Information -->
          <div class="form-section">
            <h6 class="section-title">Additional Information</h6>
            <div class="form-grid">
              <div class="form-row">
                <label>Age Limit</label>
                <input type="number" class="form-control" [(ngModel)]="eventForm.age_limit" name="ageLimit" />
              </div>

              <div class="form-row">
                <label>Status *</label>
                <select class="form-control" [(ngModel)]="eventForm.status" name="status" required>
                  <!-- <option value="draft" [selected]="eventForm.status === 'draft'">Draft</option> -->
                  <option value="active" [selected]="eventForm.status === 'active'">Active</option>
                  <option value="inactive" [selected]="eventForm.status === 'inactive'">
                    Inactive
                  </option>
                </select>
              </div>

              <!-- <div class="form-row">
                <label>Minimum Price ($)</label>
                <input type="number" step="0.01" class="form-control" [(ngModel)]="eventForm.min_price"
                  name="minPrice" />
              </div>

              <div class="form-row">
                <label>Maximum Price ($)</label>
                <input type="number" step="0.01" class="form-control" [(ngModel)]="eventForm.max_price"
                  name="maxPrice" />
              </div> -->

              <div class="form-row full-width">
                <label>Terms & Conditions</label>
                <textarea class="form-control" rows="4" [(ngModel)]="eventForm.terms_and_conditions"
                  name="termsAndConditions"></textarea>
              </div>
            </div>
          </div>

          <!-- Settings Section -->
          <div class="form-section">
            <h6 class="section-title">Settings</h6>
            <div class="form-grid">
              <div class="form-row">
                <div class="checkbox-group">
                  <label class="checkbox-label">
                    <input type="checkbox" class="form-checkbox" [(ngModel)]="eventForm.is_featured"
                      name="isFeatured" />
                    <span class="checkmark"></span>
                    Featured Event
                  </label>
                  <span class="checkbox-hint">Show this event as featured on homepage</span>
                </div>
              </div>

              <!-- <div class="form-row">
                <label>Status *</label>
                <select class="form-control" [(ngModel)]="eventForm.status" name="status" required>
                  <option value="active" [selected]="eventForm.status === 'active'">Active</option>
                  <option value="inactive" [selected]="eventForm.status === 'inactive'">
                    Inactive
                  </option>
                </select>
              </div> -->
            </div>
          </div>
        </form>
      </div>

      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" (click)="closeModalProperly('editEventModal')">
          Cancel
        </button>
        <button type="button" class="btn btn-primary btn-modal-update" (click)="updateEvent()"
          [disabled]="isSubmitting">
          <i class="fa fa-save"></i> {{ isSubmitting ? 'Updating...' : 'Update Event' }}
        </button>
      </div>
    </div>
  </div>
</div>

<!-- DELETE CONFIRMATION MODAL -->
<div class="modal fade" id="deleteConfirmModal" tabindex="-1" aria-labelledby="deleteConfirmLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="deleteConfirmLabel">Confirm Delete</h5>
        <button type="button" class="btn-close" aria-label="Close" (click)="closeModalProperly('deleteConfirmModal')"></button>
      </div>
      <div class="modal-body">
        <div class="text-center">
          <!-- <i class="fa fa-exclamation-triangle text-warning" style="font-size: 3rem;"></i> -->
          <h6>Are you sure you want to delete this event?</h6>
          <!-- <p class="text-muted small">This action cannot be undone. All associated data including artists, gallery images, and seat types will be permanently deleted.</p> -->
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" (click)="closeModalProperly('deleteConfirmModal')">
          <i class="fa fa-times"></i> No, Cancel
        </button>
        <button type="button" class="btn btn-danger" (click)="confirmDelete()" [disabled]="isDeleting">
          <i class="fa fa-trash"></i> {{ isDeleting ? 'Deleting...' : 'Yes, Delete' }}
        </button>
      </div>
    </div>
  </div>
</div>

<!-- EVENT SUMMARY MODAL -->
<div class="modal fade" id="eventSummaryModal" tabindex="-1" aria-labelledby="eventSummaryLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable">
    <div class="modal-content modal-card">
      <div class="modal-header">
        <h5 class="modal-title" id="eventSummaryLabel">
          <i class="fa fa-info-circle me-2" style="color: #2c2e72;"></i>
          Event Summary
        </h5>
        <button type="button" class="btn-close" aria-label="Close" (click)="closeModalProperly('eventSummaryModal')"></button>
      </div>

      <div class="modal-body" *ngIf="!isLoadingSummary; else loadingTemplate">
        <!-- Event Basic Info Card -->
        <div class="summary-section" *ngIf="eventSummary">
          <div class="event-title-header">
            <h4 class="event-name-summary">{{ eventSummary.eventName }}</h4>
            <span class="event-id-badge">Event ID: #{{ eventSummary.eventId }}</span>
          </div>
          
          <!-- Event Details Grid -->
          <div class="info-grid">
            <div class="info-item">
              <div class="info-label">
                <i class="fa fa-calendar"></i> Date & Time
              </div>
              <div class="info-value">
                {{ eventSummary.eventDate | date:'dd MMM yyyy' }}<br>
                <small class="text-muted">{{ eventSummary.startTime }} - {{ eventSummary.endTime }}</small>
              </div>
            </div>
            
            <div class="info-item">
              <div class="info-label">
                <i class="fa fa-map-marker"></i> Location
              </div>
              <div class="info-value">{{ eventSummary.location }}</div>
            </div>
          </div>

          <!-- Seat Statistics Cards -->
          <div class="stats-cards">
            <div class="stat-card total">
              <div class="stat-icon"><i class="fa fa-chair"></i></div>
              <div class="stat-content">
                <div class="stat-label">Total Seats</div>
                <div class="stat-value">{{ eventSummary.totalSeats | number }}</div>
              </div>
            </div>
            
            <div class="stat-card booked">
              <div class="stat-icon"><i class="fa fa-ticket"></i></div>
              <div class="stat-content">
                <div class="stat-label">Booked Seats</div>
                <div class="stat-value">{{ eventSummary.bookedSeats | number }}</div>
              </div>
            </div>
            
            <div class="stat-card available">
              <div class="stat-icon"><i class="fa fa-check-circle"></i></div>
              <div class="stat-content">
                <div class="stat-label">Available Seats</div>
                <div class="stat-value">{{ eventSummary.availableSeats | number }}</div>
              </div>
            </div>
            
            <div class="stat-card occupancy">
              <div class="stat-icon"><i class="fa fa-chart-line"></i></div>
              <div class="stat-content">
                <div class="stat-label">Occupancy</div>
                <div class="stat-value">{{ eventSummary.occupancyPercentage }}%</div>
              </div>
            </div>
          </div>

          <!-- Seat Type Details Table -->
          <div class="summary-subsection" *ngIf="eventSummary.seatTypeDetails && eventSummary.seatTypeDetails.length > 0">
            <h6 class="subsection-title">
              <i class="fa fa-chair me-2"></i> Seat Type Details
            </h6>
            <div class="table-responsive">
              <table class="table summary-table">
                <thead>
                  <tr>
                    <th>Seat Type</th>
                    <th class="text-end">Price ({{ eventSummary.currency }})</th>
                    <th class="text-center">Total</th>
                    <th class="text-center">Booked</th>
                    <th class="text-center">Available</th>
                    <th class="text-end">Revenue</th>
                    <th class="text-center">Occupancy</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let seat of eventSummary.seatTypeDetails">
                    <td><strong>{{ seat.seatName }}</strong></td>
                    <td class="text-end">{{ seat.price | currency:eventSummary.currency }}</td>
                    <td class="text-center">{{ seat.totalSeats | number }}</td>
                    <td class="text-center">{{ seat.bookedSeats | number }}</td>
                    <td class="text-center">{{ seat.availableSeats | number }}</td>
                    <td class="text-end">{{ seat.revenue | currency:eventSummary.currency }}</td>
                    <td class="text-center">
                      <span class="occupancy-badge" [ngClass]="{
                        'low': seat.occupancyPercentage < 20,
                        'medium': seat.occupancyPercentage >= 20 && seat.occupancyPercentage < 50,
                        'high': seat.occupancyPercentage >= 50
                      }">
                        {{ seat.occupancyPercentage }}%
                      </span>
                    </td>
                  </tr>
                </tbody>
                <tfoot *ngIf="eventSummary.seatTypeDetails && eventSummary.seatTypeDetails.length > 0">
                  <tr>
                    <td colspan="5" class="text-end"><strong>Totals:</strong></td>
                    <td class="text-end"><strong>{{ eventSummary.totalProfit | currency:eventSummary.currency }}</strong></td>
                    <td></td>
                  </tr>
                </tfoot>
              </table>
            </div>
          </div>

          <!-- Payment Summary -->
          <div class="summary-subsection" *ngIf="eventSummary.paymentDetails">
            <h6 class="subsection-title">
              <i class="fa fa-credit-card me-2"></i> Payment Summary
            </h6>
            
            <div class="payment-details-grid">
              <div class="payment-row">
                <div class="payment-label">Total Successful Bookings:</div>
                <div class="payment-value">{{ eventSummary.paymentDetails.totalSuccessfulBookings }}</div>
              </div>
              
              <div class="payment-row">
                <div class="payment-label">Total Amount:</div>
                <div class="payment-value highlight">{{ eventSummary.paymentDetails.totalAmount | currency:eventSummary.currency }}</div>
              </div>
              
              <div class="payment-row">
                <div class="payment-label">Total Convenience Fee:</div>
                <div class="payment-value">{{ eventSummary.paymentDetails.totalConvenienceFee | currency:eventSummary.currency }}</div>
              </div>
              
              <div class="payment-row">
                <div class="payment-label">Total GST:</div>
                <div class="payment-value">{{ eventSummary.paymentDetails.totalGST | currency:eventSummary.currency }}</div>
              </div>
              
              <div class="payment-row" *ngIf="eventSummary.paymentDetails.firstBookingDate">
                <div class="payment-label">First Booking:</div>
                <div class="payment-value">{{ eventSummary.paymentDetails.firstBookingDate | date:'dd MMM yyyy, hh:mm a' }}</div>
              </div>
              
              <div class="payment-row" *ngIf="eventSummary.paymentDetails.lastBookingDate">
                <div class="payment-label">Last Booking:</div>
                <div class="payment-value">{{ eventSummary.paymentDetails.lastBookingDate | date:'dd MMM yyyy, hh:mm a' }}</div>
              </div>
            </div>
          </div>

          <!-- No Data Message -->
          <div class="no-data-message" *ngIf="(!eventSummary.seatTypeDetails || eventSummary.seatTypeDetails.length === 0) && !eventSummary.paymentDetails">
            <i class="fa fa-info-circle"></i>
            <p>No booking data available for this event yet.</p>
          </div>
        </div>
      </div>

      <!-- Loading Template -->
      <ng-template #loadingTemplate>
        <div class="text-center py-5">
          <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Loading...</span>
          </div>
          <p class="mt-3 text-muted">Loading event summary...</p>
        </div>
      </ng-template>

      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" (click)="closeModalProperly('eventSummaryModal')">
          <i class="fa fa-times"></i> Close
        </button>
      </div>
    </div>
  </div>
</div>